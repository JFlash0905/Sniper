<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM æ¨¡æ“¬å™¨ v2.1 åˆç´„é©å‘½ğŸ”¥</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(to right, #f0f9ff, #e0ecff);
      box-sizing: border-box;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
    }
    .button-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background-color: #3498db;
      color: white;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #2980b9;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .section {
      margin: 20px auto;
      max-width: 900px;
    }
    .player {
      background: #ffffffcc;
      border-radius: 8px;
      padding: 10px;
      margin: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .player-info {
      flex-grow: 1;
    }
    .stars {
      color: gold;
      font-size: 14px;
      margin-left: 6px;
    }
    #summaryBar {
      text-align: center;
      margin-bottom: 15px;
      font-weight: bold;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="section">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v2.1 åˆç´„é©å‘½ğŸ”¥</h1>
    <div id="summaryBar">è¼‰å…¥ä¸­...</div>
    <div class="button-area">
      <button id="btnShowWarriors">å‹‡å£«é™£å®¹</button>
      <button id="btnFreeAgents">è‡ªç”±å¸‚å ´</button>
      <button id="btnOtherTeams">å…¶ä»–éšŠä¼</button>
      <button id="btnSimulate">æ¨¡æ“¬æ¯”è³½</button>
      <button id="btnResetTraining">é‡ç½®è¨“ç·´</button>
      <button id="btnTradeLog">å‹æ•—ç´€éŒ„</button>
      <button id="btnClear">æ¸…é™¤å­˜æª”</button>
    </div>
    <div id="contentArea"></div>

<script>
(() => {
const ratingMap = { C:1, "C+":2, "B-":3, B:4, "B+":5, "A-":6, A:7, "A+":8, S:9, "S+":10 };
const ratingStars = r => "â˜…".repeat(Math.min(5, Math.round((ratingMap[r]||1)/2)));

let warriors, freeAgents, otherTeams, money, salaryCap, picks, simLog, gameCount = 0;

function defaultData() {
  return {
    warriors: [
      { name:"Stephen Curry", grade:"S", rating:90, salary:35, trained:false, contract:3 },
      { name:"Klay Thompson", grade:"B+", rating:78, salary:20, trained:false, contract:2 },
      { name:"Andrew Wiggins", grade:"B+", rating:77, salary:22, trained:false, contract:2 },
      { name:"Jonathan Kuminga", grade:"B", rating:75, salary:15, trained:false, contract:3 },
      { name:"Draymond Green", grade:"B", rating:76, salary:18, trained:false, contract:2 }
    ],
    freeAgents: [
      { name:"Malik Beasley", grade:"B", rating:74, salary:15, contract:1 },
      { name:"Robert Covington", grade:"B-", rating:72, salary:12, contract:1 },
      { name:"Dennis Smith Jr.", grade:"B-", rating:71, salary:9, contract:1 }
    ],
    otherTeams: {
      ç°ç‹¼: [
        { name:"Anthony Edwards", grade:"S", rating:89, salary:32, contract:3 },
        { name:"Karl-Anthony Towns", grade:"A", rating:85, salary:28, contract:3 }
      ],
      é‡‘å¡Š: [
        { name:"Nikola Jokic", grade:"S+", rating:97, salary:38, contract:4 },
        { name:"Jamal Murray", grade:"A", rating:84, salary:27, contract:3 }
      ],
      é›·éœ†: [
        { name:"Shai Gilgeous-Alexander", grade:"S", rating:90, salary:33, contract:3 },
        { name:"Jalen Williams", grade:"A", rating:84, salary:20, contract:3 }
      ]
    },
    money: 100,
    salaryCap: 120,
    picks: 1,
    simLog: [],
    gameCount: 0
  };
}

function save() {
  localStorage.setItem("sniperJGM", JSON.stringify({
    warriors, freeAgents, otherTeams, money, salaryCap, picks, simLog, gameCount
  }));
}

function load() {
  const data = JSON.parse(localStorage.getItem("sniperJGM"));
  if (data && data.warriors) {
    ({warriors, freeAgents, otherTeams, money, salaryCap, picks, simLog, gameCount} = data);
  } else {
    ({warriors, freeAgents, otherTeams, money, salaryCap, picks, simLog, gameCount} = defaultData());
    save();
  }
}

function getTotalSalary() {
  return warriors.reduce((sum, p) => sum + (p.salary || 0), 0);
}

function renderAssets() {
  document.getElementById("summaryBar").innerHTML =
    `ğŸ’° è³‡é‡‘ï¼š$${money}Mï½œğŸ’¼ å·¥è³‡ï¼š$${getTotalSalary()}M / $${salaryCap}Mï½œğŸ¯ é¦–è¼ªç±¤ï¼š${picks}ï½œğŸ“† æ¯”è³½å ´æ•¸ï¼š${gameCount}`;
}

function renderWarriors() {
  const html = warriors.map((p, i) => `
    <div class="player">
      <div class="player-info">
        <strong>${p.name}</strong>ï½œç­‰ç´šï¼š${p.grade}ï½œè©•åˆ†ï¼š${p.rating}ï½œ$${p.salary}Mï½œåˆç´„ï¼š${p.contract}å¹´ ${p.trained ? 'ğŸ§  å·²è¨“ç·´' : ''}
        ${ratingStars(p.grade)}
      </div>
      <button ${p.trained ? "disabled" : ""} onclick="trainPlayer(${i})">è¨“ç·´</button>
    </div>`).join("");
  document.getElementById("contentArea").innerHTML = `<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>${html}`;
}

window.trainPlayer = function(index) {
  const player = warriors[index];
  if (!player.trained) {
    player.trained = true;
    player.rating += 1;
    alert(`${player.name} çš„è©•åˆ†æå‡è‡³ ${player.rating} åˆ†ï¼`);
    save();
    renderWarriors();
    renderAssets();
  }
};

function renderFreeAgents() {
  const html = freeAgents.map((p, i) => `
    <div class="player">
      <div class="player-info">
        <strong>${p.name}</strong>ï½œç­‰ç´šï¼š${p.grade}ï½œè©•åˆ†ï¼š${p.rating}ï½œ$${p.salary}Mï½œåˆç´„ï¼š${p.contract}å¹´
        ${ratingStars(p.grade)}
      </div>
      <button onclick="signFreeAgent(${i})">ç°½ä¸‹</button>
    </div>`).join("");
  document.getElementById("contentArea").innerHTML = `<h2>ğŸ“ è‡ªç”±å¸‚å ´</h2>${html}`;
}

window.signFreeAgent = function(index) {
  const player = freeAgents[index];
  if (money >= player.salary) {
    const contractYears = Math.floor(Math.random() * 5) + 1;
    warriors.push({...player, trained: false, contract: contractYears});
    money -= player.salary;
    freeAgents.splice(index, 1);
    alert(`${player.name} ç°½ä¸‹æˆåŠŸï¼Œåˆç´„ ${contractYears} å¹´ï¼`);
    save();
    renderFreeAgents();
    renderAssets();
  } else {
    alert("è³‡é‡‘ä¸è¶³ï¼");
  }
};

function simulateGame() {
  const teamScore = warriors.reduce((sum, p) => sum + p.rating, 0);
  const rand = Math.random() * 100;
  const result = (teamScore + rand > 300) ? "å‹åˆ©" : "æ•—åŒ—";

  const date = new Date().toLocaleString();
  simLog.unshift(`[${date}] æ¨¡æ“¬æ¯”è³½çµæœï¼š${result}ï½œç¸½è©•åˆ†ï¼š${teamScore}`);
  simLog = simLog.slice(0, 10);
  gameCount++;

  if (gameCount % 10 === 0) {
    decreaseContracts();
    removeExpiredContracts();
  }

  alert(`æœ¬å ´æ¯”è³½ï¼š${result}ï¼`);
  save();
  renderAssets();
}

function showSimLog() {
  const logHtml = simLog.length ? simLog.map(item => `<div>${item}</div>`).join("") : "ç›®å‰ç„¡ç´€éŒ„";
  document.getElementById("contentArea").innerHTML = `<h2>ğŸ“œ å‹æ•—ç´€éŒ„</h2>${logHtml}`;
}

function decreaseContracts() {
  warriors.forEach(p => {
    if (p.contract > 0) p.contract -= 1;
  });
}

function removeExpiredContracts() {
  const expired = warriors.filter(p => p.contract === 0);
  if (expired.length > 0) {
    expired.forEach(p => {
      const randomYears = Math.floor(Math.random() * 5) + 1;
      freeAgents.push({...p, trained: false, contract: randomYears});
    });
    warriors = warriors.filter(p => p.contract > 0);
    alert(`ä»¥ä¸‹çƒå“¡å·²åˆ°æœŸä¸¦é€²å…¥è‡ªç”±å¸‚å ´ï¼š\n${expired.map(p => p.name).join(", ")}`);
  }
}

function renderTeamSelection() {
  const teams = Object.keys(otherTeams);
  const html = teams.map(t => `<button onclick="renderOtherTeam('${t}')">${t}</button>`).join(" ");
  document.getElementById("contentArea").innerHTML = `<h2>ğŸŒ é¸æ“‡å…¶ä»–éšŠä¼</h2>${html}`;
}

window.renderOtherTeam = function(team) {
  const players = otherTeams[team];
  const html = players.map(p => `
    <div class="player">
      <div class="player-info"><strong>${p.name}</strong>ï½œç­‰ç´šï¼š${p.grade}ï½œè©•åˆ†ï¼š${p.rating}ï½œ$${p.salary}Mï½œåˆç´„ï¼š${p.contract}å¹´ ${ratingStars(p.grade)}</div>
      <button onclick="startTrade('${team}','${p.name}')">äº¤æ˜“</button>
    </div>`).join("");
  document.getElementById("contentArea").innerHTML = `<h2>ğŸ‘¥ ${team} çƒå“¡åˆ—è¡¨</h2>${html}`;
};

window.startTrade = function(team, targetName) {
  const offer = prompt(`ä½ æƒ³ç”¨å“ªäº›å‹‡å£«çƒå“¡ä¾†æ› "${targetName}"ï¼Ÿè«‹ç”¨é€—è™Ÿåˆ†éš”åç¨±ï¼Œå¦‚ï¼šWiggins,Kuminga`);
  const includePick = confirm("æ˜¯å¦åŒ…å«é¦–è¼ªç±¤ï¼Ÿ");
  if (!offer) return;

  const offerNames = offer.split(",").map(n => n.trim());
  const offerPlayers = warriors.filter(p => offerNames.includes(p.name));
  const targetPlayer = otherTeams[team].find(p => p.name === targetName);
  const offerTotal = offerPlayers.reduce((s, p) => s + p.salary, 0) + (includePick ? 5 : 0);
  const targetSalary = targetPlayer.salary;

  if (Math.abs(offerTotal - targetSalary) <= 5) {
    warriors = warriors.filter(p => !offerNames.includes(p.name));
    warriors.push({...targetPlayer, trained:false});
    otherTeams[team] = otherTeams[team].filter(p => p.name !== targetName);
    offerPlayers.forEach(p => otherTeams[team].push(p));
    if (includePick && picks > 0) picks--;
    alert(`âœ… äº¤æ˜“æˆåŠŸï¼${targetName} åŠ å…¥å‹‡å£«ã€‚`);
    save();
    renderOtherTeam(team);
    renderAssets();
  } else {
    alert("âš ï¸ è–ªè³‡ä¸ç¬¦ï¼Œäº¤æ˜“å¤±æ•—ã€‚è«‹ä¿æŒè–ªè³‡å·®é¡åœ¨ Â±5M ä»¥å…§");
  }
};

function resetTrainingStatus() {
  warriors.forEach(p => p.trained = false);
  alert("âœ… å·²é‡ç½®æ‰€æœ‰çƒå“¡çš„è¨“ç·´ç‹€æ…‹ï¼");
  save();
  renderWarriors();
}

function resetSave() {
  if (confirm("ä½ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™ä¸¦é‡å•ŸéŠæˆ²å—ï¼Ÿ")) {
    localStorage.removeItem("sniperJGM");
    location.reload();
  }
}

function setup() {
  load();
  renderAssets();
  renderWarriors();
  document.getElementById("btnShowWarriors").onclick = renderWarriors;
  document.getElementById("btnFreeAgents").onclick = renderFreeAgents;
  document.getElementById("btnOtherTeams").onclick = renderTeamSelection;
  document.getElementById("btnSimulate").onclick = simulateGame;
  document.getElementById("btnTradeLog").onclick = showSimLog;
  document.getElementById("btnResetTraining").onclick = resetTrainingStatus;
  document.getElementById("btnClear").onclick = resetSave;
}

window.onload = setup;
})();
</script>
</body>
</html>